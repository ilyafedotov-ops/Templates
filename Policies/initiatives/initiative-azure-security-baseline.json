{
  "properties": {
    "displayName": "Azure Security Baseline (Custom)",
    "description": "Bundled guardrails for diagnostics, networking, encryption, TLS, and governance.",
    "policyType": "Custom",
    "parameters": {
      "allowedLocations": {
        "type": "Array",
        "metadata": {"displayName": "Allowed locations"}
      },
      "requiredTagName": {
        "type": "String",
        "metadata": {"displayName": "Required tag name"},
        "defaultValue": "owner"
      },
      "tagEffect": {
        "type": "String",
        "metadata": {"displayName": "Tag policy effect"},
        "allowedValues": ["Audit", "Deny"],
        "defaultValue": "Audit"
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionReferenceId": "diag-audit",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/diag-audit-custom"
        }
      },
      {
        "policyDefinitionReferenceId": "allowed-locations",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/allowed-locations-custom"
        },
        "parameters": {
          "listOfAllowedLocations": {"value": "[parameters('allowedLocations')]"}
        }
      },
      {
        "policyDefinitionReferenceId": "require-tags",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/require-tags-custom"
        },
        "parameters": {
          "tagName": {"value": "[parameters('requiredTagName')]"},
          "effect": {"value": "[parameters('tagEffect')]"}
        }
      },
      {
        "policyDefinitionReferenceId": "storage-public-network-deny",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/storage-public-network-deny-custom"
        }
      },
      {
        "policyDefinitionReferenceId": "storage-private-endpoint-audit",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/storage-private-endpoint-audit-custom"
        }
      },
      {
        "policyDefinitionReferenceId": "appservice-min-tls",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/appservice-min-tls-custom"
        }
      },
      {
        "policyDefinitionReferenceId": "storage-secure-transfer",
        "policyDefinition": {
          "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/storage-secure-transfer-custom"
        }
      }
    ]
  }
}

